<!DOCTYPE html>
<html lang="ko">
<head>
  <base href="/pathAni/">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" type="text/css" href="resource/css/common.css">
  <script src="resource/js/jquery-3.7.1.min.js"></script>
  <script src="resource/js/ui-common.js"></script>
  <link rel="stylesheet" type="text/css" href = "resource/devEx/css/dx.light.css"/>   
  <script type="text/javascript" src="resource/devEx/js/dx.all.js"></script>
  <script type="text/javascript" src="resource/js/plugins/jquery.awesomeCloud-0.2.js"></script>
  <script type="text/javascript" src="html/pages/pub-only.js"></script><!-- 퍼블 확인용 -->
</head>
<body>
  <div class="wrapper">
    <!-- header -->
    <header class="header">
      <div class="header-wrap">
        <div class="logo"><img src="resource/images/logo.png" alt="라우팅봇"></div>
      </div>
    </header>
    <!--// header -->
    <div class="container">
      <nav class="nav">
        <ul class="navList"> 
          <li class="active">
            <a href="javascript:void(0);" class="nav-dep1"><i class="im-dashboard">대시보드</i></a>
            <div class="nav-dep2-list">
              <div class="tit">대시보드</div>
              <ul>
                <li data-nav-title="통합대시보드" data-nav-url="html/pages/page-dashboard.html"><a href="javascript:void(0);" class="nav-dep2"><span>통합 대시보드</span></a></li>
                <li data-nav-title="라우팅봇 대시보드" data-nav-url="html/pages/page-botDashboard.html"><a href="javascript:void(0);" class="nav-dep2"><span>라우팅봇 대시보드</span></a></li>
              </ul>
            </div>
          </li> 
          <li>    
            <a href="javascript:void(0);" class="nav-dep1"><i class="im-statistics">통계</i></a>
            <div class="nav-dep2-list">
              <div class="tit">대시보드</div>
              <ul>
                <li data-nav-title="라우팅봇 서비스현황" data-nav-url="/html/pages/page-RoutingBot.html"><a href="javascript:void(0);" class="nav-dep2" ><span>라우팅봇 서비스현황</span></a></li>
                <li data-nav-title="AI키워드 실적"  data-nav-url="/html/pages/page-Aikeyword.html"><a href="javascript:void(0);" class="nav-dep2"><span>AI키워드 실적</span></a></li>
                <li data-nav-title="대화흐름" data-nav-url="/html/pages/page-conversationFlow.html"><a href="javascript:void(0);" class="nav-dep2"><span>대화흐름</span></a></li>
                <li data-nav-title="미지원 고객 발화 로그" data-nav-url="/html/pages/page-customIgnitionLog.html"><a href="javascript:void(0);" class="nav-dep2"><span>미지원 고객 발화 로그</span></a></li>
              </ul>
            </div>
          </li>
        </ul>
      </nav>
      <div class="contents">
        <div class="tab-nav">
          <ul class="tab-nav-list">
            <li data-key="통합대시보드"><a href="javascript:void(0);" class="tab-nav-link" data-url="html/pages/page-dashboard.html" data-title="통합대시보드">통합대시보드</a></li>
          </ul>
        </div>
        <div class="contents-wrap"></div>
      </div>
    </div> 
  </div>
  <script> 
  const tabNavs = {
    init: function(){
      this._contElem();
      this._initDefault();// 초기셋팅
      this._setEvent();
    },
    _contElem: function(){
      this.$tabList = $('.tab-nav-list');
      this.$contents = $('.contents-wrap');
    },
    _toKey: function(s){
      return String(s || '');
    },
    _activateByKey: function(key){ //load 컨텐츠
      var $tabList = this.$tabList;
      var $contents = this.$contents;
      $tabList.find('li').removeClass('active');
      var $li = $tabList.find('li[data-key="' + key + '"]').addClass('active');
      $('.navList').find('li').removeClass('active');
      $('.navList').find('li[data-nav-title="' + key + '"]').addClass('active');
       $('.navList').find('li[data-nav-title="' + key + '"]').parents('li').addClass('active')
      var $a = $li.find('a.tab-nav-link');
      var title = $a.data('title');
      var url   = $a.data('url'); 
      if(url){
        $contents.load(url, function(response, status, xhr){        
          if(status === 'error'){
            $contents.html('<div style="padding:1rem;color:red">불러오기 실패: ' + xhr.status + '</div>');
          }
          //퍼블 확인용
          if(url.indexOf('botDashboard') > 0 || url.indexOf('conversationFlow') > 0 || url.indexOf('Aikeyword') > 0 || url.indexOf('RoutingBot') > 0 || url.indexOf('customIgnitionLog') > 0){
            PUB_ONLY.devExpressCalendar();
          }
        });
      }else{
        $contents.html('<div>' + title + ' 콘텐츠 url 없습니다.</div>');
      }
    },
    _ensureTab: function(title, opts){
      opts = opts || {}; 
      var $tabList = this.$tabList; 
      var key = opts.key || this._toKey(title);
      var exists = $tabList.find('li[data-key="' + key + '"]').length > 0;
      if (exists){
        this._activateByKey(key);
        return key;
      }
      var closable = opts.closable !== false;
      var $li = $('<li/>', { 'data-key': key });
      var $a  = $('<a/>', {
        href: '#',
        'class': 'tab-nav-link',
        text: title,
        'data-title': title,
        'data-url': opts.url || ''
      });
      $li.append($a);
      if (closable){
        var $closeBtn = $('<button/>', {
          'class': 'tab-nav-close',
          type: 'button'
        });
        $li.append($closeBtn);
      }
      $tabList.append($li);
      this._activateByKey(key);
      return key;
    },
    _initDefault: function(){
      var $tabList = this.$tabList;
      var $contents = this.$contents;
      var $default = $tabList.find('li').first();
      // var title = $.trim($default.text()) || '통합대시보드';
      // $default.attr('data-key', this._toKey(title));
      // $default.find('a').addClass('tab-nav-link').attr('data-title', title);
      $default.addClass('active');
      var key = $default.data('key');
      if (key != null) {
        this._activateByKey(key);
      }
    },
    _setEvent: function(){
      var self = this;
      $(document).on('click', '.nav a.nav-dep2, .nav a.nav-dep1', function(e){
        e.preventDefault();
        var $a = $(this).parent('li');
        var title = $a.data('nav-title');
        var url = $a.data('nav-url');
        if(!title){
          return;
        }
        var isHome = self._toKey(title) === self._toKey('통합대시보드');
        self._ensureTab(title, { closable: !isHome, url: url });
      });
      this.$tabList.on('click', 'a.tab-nav-link', function(e){
        e.preventDefault();
        var key = $(this).closest('li').data('key');
        if(key != null) self._activateByKey(key);
      });
      this.$tabList.on('click', '.tab-nav-close', function(e){
        e.preventDefault();
        e.stopPropagation();
        var $li = $(this).closest('li');
        var wasActive = $li.hasClass('active');
        var $prev = $li.prev('li');
        $li.remove();
        if (wasActive){
          var $target = $prev.length ? $prev : self.$tabList.find('li').first();
          var key = $target.data('key');
          if (key != null) self._activateByKey(key);
        }
      });
    }
  };
  tabNavs.init();
</script>
</body>
</html>